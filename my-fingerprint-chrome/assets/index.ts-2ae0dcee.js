import{g as je,a as Ue,b as Ie,H as S,s as Ge,d as Ve,c as Q,e as he,f as $e,t as Fe}from"./enum-f72cb271.js";import{M as B}from"./runtime-2dd7245f.js";const J=1,ze={languages:navigator.languages},R={browser:je(navigator.userAgent),ua:void 0,lang:void 0,exIds:void 0,whitelistSet:void 0},We=async(a,d,f)=>{if(!R.exIds){const g=await chrome.declarativeNetRequest.getSessionRules();R.exIds=new Set(g[0]?.condition?.excludedTabIds)}if(d!==void 0)if(Array.isArray(d))for(const g of d)R.exIds.has(g)||(R.exIds.add(g),a.isUpdate=!0);else R.exIds.has(d)||(R.exIds.add(d),a.isUpdate=!0);if(f!==void 0)if(Array.isArray(f))for(const g of f)R.exIds.has(g)&&(R.exIds.delete(g),a.isUpdate=!0);else R.exIds.has(f)&&(R.exIds.delete(f),a.isUpdate=!0);return R.exIds},ye=(a,d)=>{switch(d?.type){case S.browser:return a.seed.browser;case S.global:return a.seed.global;default:return}},He=async({config:a},d)=>{const f=a.fp.navigator.uaVersion,g=`${f.type}:${a.seed.global}:${a.seed.browser}`,b=R.ua;if(b&&b[0]===g)return b[1];const y=[],x=ye(a,f);if(x){y.push({header:"User-Agent",operation:"set",value:Ue(x,navigator)});const P=await Ie(x,navigator);P.brands&&y.push({header:"Sec-Ch-Ua",operation:"set",value:P.brands.map(D=>`"${D.brand}";v="${D.version}"`).join(", ")}),P.fullVersionList&&y.push({header:"Sec-Ch-Ua-Full-Version-List",operation:"set",value:P.fullVersionList.map(D=>`"${D.brand}";v="${D.version}"`).join(", ")}),P.uaFullVersion&&y.push({header:"Sec-Ch-Ua-Full-Version",operation:"set",value:P.uaFullVersion})}return R.ua=[g,y],d.isUpdate=!0,y},ke=({config:a},d)=>{const f=a.fp.navigator.languages,g=`${f.type}:${f.value??""}:${a.seed.global}:${a.seed.browser}`,b=R.lang;if(b&&b[0]===g)return b[1];const y=[];if(f&&f.type!==S.default){let x;if(f.type===S.value)x=f.value;else{const P=ye(a,f);P&&(x=Ge(ze.languages,P))}if(x?.length){const[P,...D]=x;let O=1;for(let M=0;M<D.length&&O>.1;M++)O-=.1,D[M]=`${D[M]};q=${O.toFixed(1)}`;y.push({header:"Accept-Language",operation:"set",value:[P,...D].join(",")})}}return R.lang=[g,y],d.isUpdate=!0,y},qe=({whitelist:a},d)=>{const f=R.whitelistSet;(!f||f.size!==a.length||a.some(g=>!f.has(g)))&&(R.whitelistSet=new Set(a),d.isUpdate=!0)},fe=async()=>await chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:[J]}).catch(()=>{}),E=async(a,d)=>{const[f]=await C();if(!f.config.enable||!f.config.action.hookNetRequest)return await fe();const g={isUpdate:!1},b=R.browser==="firefox"?[]:await He(f,g),y=ke(f,g),x=await We(g,a,d);if(qe(f,g),g.isUpdate){const P=[...b,...y];return P.length===0?await fe():await chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:[J],addRules:[{id:J,condition:{excludedInitiatorDomains:[...f.whitelist],resourceTypes:Object.values(chrome.declarativeNetRequest.ResourceType),excludedTabIds:[...x]},action:{type:"modifyHeaders",requestHeaders:P}}]}).catch(()=>{})}};let H;const Ze=a=>({storage:a,whitelist:{match:d=>$e(a.whitelist,d),add(d){a.whitelist.push(d)},remove(d){const f=a.whitelist.indexOf(d);f!==-1&&a.whitelist.splice(f,1)},clean(){a.whitelist=[]}},[Symbol.iterator](){return Object.values(this)[Symbol.iterator]()}}),Ke=()=>{const a=chrome.runtime.getManifest(),d=Q();return{version:a.version,config:{enable:!0,seed:{browser:Q(),global:d},fp:{navigator:{uaVersion:{type:S.browser},language:{type:S.default},languages:{type:S.default},hardwareConcurrency:{type:S.default}},screen:{height:{type:S.default},width:{type:S.default},colorDepth:{type:S.default},pixelDepth:{type:S.default}},normal:{glVendor:{type:S.default},glRenderer:{type:S.default}},other:{timezone:{type:S.default},canvas:{type:S.browser},audio:{type:S.default},webgl:{type:S.browser},webrtc:{type:S.default},font:{type:S.default},webgpu:{type:S.default}}},action:{hookNetRequest:!0,hookBlankIframe:!0},input:{globalSeed:String(d)},subscribe:{url:"config.json"},language:navigator.language},whitelist:[]}},re=(a,d)=>{if(!d)return a;for(const f in d)f!=="value"&&(f in a||delete d[f]);for(const f in a){const g=a[f];if(f in d){if(f==="value")continue;typeof g=="object"&&!Array.isArray(g)&&re(g,d[f])}else d[f]=g}return d},ne=Ve(async()=>{const a=await chrome.storage.local.get();let d=Ke();const f=re(d.config,a.config),g=Object.keys(a).filter(y=>!(y in d));g.length&&chrome.storage.local.remove(g);const b={version:d.version,config:f,whitelist:a.whitelist??d.whitelist};return H=Ze(b),chrome.storage.local.set(b).then(()=>{E(),me()}),H}),me=async()=>{const[a,{match:d}]=await C();let f=a.config.subscribe.url.trim();if(f==="")return!0;f.includes("://")||(f=chrome.runtime.getURL(f));const g=await fetch(f).then(b=>b.json()).catch(b=>console.warn("Pull config failed: "+b));if(!g)return!1;if(g.config&&Object.keys(g.config).length&&await ee(g.config),g.whitelist?.length){const b=g.whitelist.filter(y=>!d(y));b.length&&await ve({add:b})}return!0},C=async()=>H!==void 0?H:await ne(),be=he(a=>{chrome.storage.local.set({config:a})},500),we=he(a=>{a instanceof Set?chrome.storage.local.set({whitelist:[...a]}):chrome.storage.local.set({whitelist:a})},500),ee=async a=>{const[d]=await C();return d.config=re(d.config,a),be(d.config),E(),d.config},ve=async a=>{const[d,{add:f,remove:g}]=await C();return a.del?.length&&a.del.forEach(b=>g(b)),a.add?.length&&a.add.forEach(b=>f(b)),we(d.whitelist),E(),d.whitelist},Ye=async()=>{const[a,{clean:d}]=await C();d(),we(a.whitelist),E()},xe=async()=>{const[a]=await C();a.config.seed.browser=Q(),be(a.config),E()},Xe=["timezone","canvas","audio","font","webgl","webrtc","webgpu"],k={whitelist:"#fff",low:"#7FFFD4",high:"#F4A460"},Qe=a=>{let d=0,f=0;for(const[b,y]of Object.entries(a))Xe.includes(b)?f+=y:d+=y;const g=f||d;return[g>=100?"99+":String(g),f?k.high:k.low]},Je=a=>{chrome.action.setBadgeText({tabId:a,text:"-"}).catch(()=>{}),chrome.action.setBadgeTextColor({tabId:a,color:k.whitelist}).catch(()=>{}),chrome.action.setBadgeBackgroundColor({tabId:a,color:k.whitelist}).catch(()=>{})},et=a=>{chrome.action.setBadgeText({tabId:a,text:""}).catch(()=>{})};function Se(a){var d;(function(e){e.SetHookRecords="set-hook-records",e.GetHookInfo="get-hook-info",e.StartHook="start-hook"})(d||(d={}));const f="my_fingerprint",g=e=>e.data?.[f],b=(e,t,r)=>{e.postMessage({[f]:t},r??location.origin)};var y;(function(e){e[e.default=0]="default",e[e.value=1]="value",e[e.page=2]="page",e[e.browser=3]="browser",e[e.domain=4]="domain",e[e.global=5]="global",e[e.enabled=6]="enabled",e[e.disabled=7]="disabled"})(y||(y={}));const x=function(e,t=1,r=0){typeof e=="string"&&(e=M(e));const n=233280;e=(e*9301+49297)%n,e<0&&(e+=n);const i=e/n;return r+i*(t-r)},P=(e,t)=>e[t%e.length],D=(e,t)=>{const r=[...e];let n=r.length,i,u;const s=()=>{const o=Math.sin(t++)*1e4;return o-Math.floor(o)};for(;n;)u=Math.floor(s()*n--),i=r[n],r[n]=r[u],r[u]=i;return r},O=function(){return Math.floor(x(Math.random()*1e6,Number.MAX_SAFE_INTEGER,1))},M=e=>{let t=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);t=(t<<5)-t+n,t=t&t}return Math.abs(t%Number.MAX_SAFE_INTEGER)},Pe=e=>e===0?0:e===1?10:(e<0&&(e=-e),Math.pow(10,Math.ceil(Math.log10(e)))),q=(e,t,r,n=0)=>{let[i,...u]=t.split(".");if(n>0){let o=Number(i);i=!isNaN(o)&&o>=n?String(Math.floor(x(e,o,o-10))):i}if(u.length===0)return{major:i,full:i};r=r??u.length;const s=[];for(let o=0;o<r;o++){const p=Number(u[o]);if(isNaN(p)){s.push(u[o]);continue}const c=Pe(p),l=Math.floor(x(e+o,c,0));s.push(l.toString())}return{major:i,full:[i,...s].join(".")}},Re=(e,t)=>!t||!e?.length?!1:(t="."+t,e.some(r=>t.endsWith("."+r))),De=e=>{const t=[];for(let r=0;r<10;r++)t.push(Math.floor(x(e++,255,0)));return t},Ce=e=>[x(e,1,-1),x(e+1,1,-1)],Ee=(e,t)=>{const r=x((e+M(t))%Number.MAX_SAFE_INTEGER,3,0);return r*10%1<.9?0:Math.floor(r)-1},Oe=function(e,t){t=t||300;let r;return function(...n){clearTimeout(r),r=setTimeout(()=>e(...n),t)}},Me=function(e,t){t=t||300;const r=new Map;return function(n,...i){r.has(n)&&clearTimeout(r.get(n)),r.set(n,setTimeout(()=>{e(n,...i),r.delete(n)},t))}},ae={uaSeries:new Map},_e=e=>{if(e.includes("Chrome"))return"chrome";if(e.includes("Firefox"))return"firefox"};class j{name;version;constructor(t,r){this.name=t,this.version=r}static parse(t){const r=t.split("/");return new j(r[0],r[1])}toString(){return this.version?`${this.name}/${this.version}`:this.name}setName(t){this.name=t}setVersion(t){this.version=t}}class V{static uaRule=/^(?<product>.+?) \((?<systemInfo>.+?)\)( (?<engine>.+?))?( \((?<engineDetails>.+?)\))?( (?<extensions>.+?))?$/;static firefoxUaRule=/^(?<product>.+?) \((?<systemInfo>.+?)\) (?<extensions>.+?)$/;type;product;systemInfo;engine;engineDetails;extensions;constructor(t){let r;if(t.includes("Firefox")?(this.type="firefox",r=t.match(V.firefoxUaRule)?.groups):(this.type="base",r=t.match(V.uaRule)?.groups),!r)throw new Error("unable to parse");this.product=j.parse(r.product),this.systemInfo=r.systemInfo.split(";").map(n=>n.trim()),this.engine=r.engine?.split(" ").map(n=>j.parse(n)),this.engineDetails=r.engineDetails?.split(",").map(n=>n.trim()),this.extensions=r.extensions?.split(" ").map(n=>j.parse(n))}toString(t){let r;t?r=this.product.version:r=this.product.toString();const n=this.systemInfo.join("; "),i=this.engine?.map(s=>s.toString()).join(" "),u=this.extensions?.map(s=>s.toString()).join(" ");if(this.type==="firefox")return`${r} (${n}) ${i} ${u}`;{const s=this.engineDetails?.join(", ");return`${r} (${n}) ${i} (${s}) ${u}`}}}const $=(e,t)=>({...t,version:t.version&&q(e,t.version).full}),se=(e,t,r)=>{const n=r?"app":"ua",i=`${e}:${t.userAgent}`,u=ae.uaSeries.get(i);if(u)return u[n];try{const s=new V(t.userAgent);if(s.extensions?.length)for(const p of s.extensions)p.name?.toLocaleLowerCase()!=="safari"&&p.version&&p.setVersion(q(e,p.version).full);const o={ua:s.toString(),app:s.toString(r)};return ae.uaSeries.set(i,o),o[n]}catch{return r?t.appVersion:t.userAgent}},F=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3],U=(e,t,r)=>{t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2],t[3]=e[r+3]},ie=(e,t,r,n,i,u,s,o)=>{const p=e.call(r,n,i,u,s,o);let c=0,l=!1;const h=new Uint8ClampedArray(4),m=new Uint8ClampedArray(4),w=new Uint8ClampedArray(4),v=new Uint8ClampedArray(4),I=new Uint8ClampedArray(4),A=p.data;e:for(let _=1;_<s-2;_+=2)for(let L=1;L<u-2;L+=2){if(t.length===c)break e;const de=(_*u+L)*4;U(A,h,de),U(A,m,((_-1)*u+L)*4),!F(h,m)&&(U(A,w,((_+1)*u+L)*4),!F(h,w)&&(U(A,v,(_*u+(L-1))*4),!F(h,v)&&(U(A,I,(_*u+(L+1))*4),!F(h,I)&&(A[de+3]=t[c++]%256,l=!0))))}return l&&r.putImageData(p,n,i),p},Le=(e,t)=>{if(t)return new Proxy(t,{get:(r,n)=>{switch(n){case"brands":{const u=r[n];return u?.map?.(o=>$(e,o))??u}case"toJSON":{const u=r[n];return u&&new Proxy(u.bind(r),{apply:(s,o,p)=>{const c=s.apply(o,p);return c?.brands?.map?.(h=>$(e,h))??c}})}case"getHighEntropyValues":{const u=r[n];return u&&new Proxy(u.bind(r),{apply:(s,o,p)=>s.apply(o,p)?.then(c=>c&&{...c,brands:c.brands?.map?.(l=>$(e,l)),fullVersionList:c.fullVersionList?.map?.(l=>$(e,l)),uaFullVersion:c.uaFullVersion&&q(e,c.uaFullVersion).full})})}}const i=r[n];return typeof i=="function"?i.bind(r):i}})},ce=(e,t)=>{const r="attribute vec4 noise;void main() {gl_Position = noise;gl_PointSize = 0.001;}",n="void main() {gl_FragColor = vec4(0.0, 0.0, 0.0, 0.01);}",i=(h,m,w)=>{const v=h.createShader(m);if(v)return h.shaderSource(v,w),h.compileShader(v),v},u=i(e,e.VERTEX_SHADER,r),s=i(e,e.FRAGMENT_SHADER,n);if(!u||!s)return;const o=e.createProgram();if(!o)return;e.attachShader(o,u),e.attachShader(o,s),e.linkProgram(o),e.useProgram(o);const p=new Float32Array(t),c=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,p,e.STATIC_DRAW);const l=e.getAttribLocation(o,"noise");e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1)},le=e=>({names:Object.getOwnPropertyNames(e),symbols:Object.getOwnPropertySymbols(e),descriptors:Object.getOwnPropertyDescriptors(e),keys:Reflect.ownKeys(e)}),Ne=Object.entries({"iframe html hook":{condition:({conf:e})=>e.action.hookBlankIframe,onEnable:({win:e,hookIframe:t})=>{const r=new MutationObserver(i=>{for(const u of i)for(const s of u.addedNodes)s.nodeName==="IFRAME"&&t(s)});r.observe(e.document.documentElement,{childList:!0,subtree:!0});const n=()=>{r.disconnect(),e.removeEventListener("DOMContentLoaded",n,{capture:!0}),e.removeEventListener("load",n,{capture:!0})};e.addEventListener("DOMContentLoaded",n,{capture:!0}),e.addEventListener("load",n,{capture:!0})}},"iframe script hook":{condition:({conf:e})=>e.action.hookBlankIframe,onEnable:({win:e,hooks:t,registry:r,hookIframe:n})=>{const i=t.useBaseHandler({apply(u,s,o){const p=Reflect.apply(u,s,o),c=o[0];return c?.tagName==="IFRAME"&&n(c),p}});e.Node.prototype.appendChild=t.newProxy(e.Node.prototype.appendChild,i),e.Node.prototype.insertBefore=t.newProxy(e.Node.prototype.insertBefore,i),e.Node.prototype.replaceChild=t.newProxy(e.Node.prototype.replaceChild,i)}},navigator:{condition:({conf:e,isAllDefault:t})=>!t(e.fp.navigator),onEnable:({win:e,conf:t,info:r,symbol:n,getSeed:i,getValue:u})=>{const s=Object.getOwnPropertyDescriptors(e.Navigator.prototype);if(!s)return;e.navigator[n.own]=le(e.navigator);const o=s.userAgent?.get,p=s.appVersion?.get;o&&p&&(Object.defineProperty(e.navigator,"userAgent",{get(){if(r.browser==="firefox")return o.call(this);const h=i(t.fp.navigator.uaVersion.type);return h!==null?(T("userAgent"),se(h,{userAgent:o.call(this),appVersion:p.call(this)})):o.call(this)}}),Object.defineProperty(e.navigator,"appVersion",{get(){if(r.browser==="firefox")return p.call(this);const h=i(t.fp.navigator.uaVersion.type);return h!==null?(T("appVersion"),se(h,{userAgent:o.call(this),appVersion:p.call(this)},!0)):p.call(this)}}));const c=s.userAgentData?.get;c&&Object.defineProperty(e.navigator,"userAgentData",{get:new Proxy(c,{apply:(h,m,w)=>{if(r.browser==="firefox")return c.call(m);const v=i(t.fp.navigator.uaVersion.type);return v!==null?(T("userAgent"),Le(v,h.apply(m,w))):c.call(m)}})});const l=h=>{const m=s[h]?.get;m&&Object.defineProperty(e.navigator,h,{get(){const w=t.fp.navigator[h],v="navigator."+h,I=u(v,w);return I!==null?I:m.call(this)}})};l("language"),l("languages"),l("hardwareConcurrency")}},screen:{condition:({conf:e,isAllDefault:t})=>!t(e.fp.screen),onEnable:({win:e,conf:t,getValue:r})=>{const n=Object.getOwnPropertyDescriptors(e.Screen.prototype);if(!n)return;e.screen[symbol.own]=le(e.screen);const i=u=>{const s=n[u]?.get;s&&Object.defineProperty(e.screen,u,{get(){const o=t.fp.screen[u],p="screen."+u,c=r(p,o);return c!==null?c:s.call(this)}})};i("width"),i("height"),i("colorDepth"),i("pixelDepth")}},canvas:{condition:({conf:e})=>e.fp.other.canvas.type!==y.default,onEnable:({win:e,conf:t,hooks:r,rawObjects:n,getValue:i})=>{const u=e.HTMLCanvasElement.prototype.getContext;e.HTMLCanvasElement.prototype.getContext=r.newBaseProxy(u,{apply:(o,p,c)=>{if(c[0]==="2d"){const l=c[1]??{};l.willReadFrequently=!0,c[1]=l}return o.apply(p,c)}});const s=e.CanvasRenderingContext2D.prototype.getImageData;n.getImageData=s,e.CanvasRenderingContext2D.prototype.getImageData=r.newBaseProxy(s,{apply:(o,p,c)=>{const l=i("other.canvas",t.fp.other.canvas);return l!==null?ie(s,l,p,...c):o.apply(p,c)}})}},webgl:{condition:({conf:e})=>e.fp.other.webgl.type!==y.default||e.fp.normal.glVendor.type!==y.default||e.fp.normal.glRenderer.type!==y.default,onEnable:({win:e,conf:t,hooks:r,getValue:n,random:i})=>{const u=t.fp.other.webgl.type!==y.default,s=t.fp.normal.glVendor.type!==y.default||t.fp.normal.glRenderer.type!==y.default;if(u){const o=e.WebGLRenderingContext.prototype.readPixels,p=e.WebGL2RenderingContext.prototype.readPixels,c=r.useBaseHandler({apply:(l,h,m)=>{const w=n("other.webgl",t.fp.other.webgl);return w&&ce(h,w),l.apply(h,m)}});e.WebGLRenderingContext.prototype.readPixels=r.newProxy(o,c),e.WebGL2RenderingContext.prototype.readPixels=r.newProxy(p,c)}if(u){const o=e.WebGLRenderingContext.prototype.getSupportedExtensions,p=e.WebGL2RenderingContext.prototype.getSupportedExtensions,c=r.useBaseHandler({apply:(l,h,m)=>{const w=l.apply(h,m);if(w){const v=i("other.webgl",t.fp.other.webgl);v&&w.push?.("EXT_"+v)}return w}});e.WebGLRenderingContext.prototype.getSupportedExtensions=r.newProxy(o,c),e.WebGL2RenderingContext.prototype.getSupportedExtensions=r.newProxy(p,c)}if(s){const o=e.WebGLRenderingContext.prototype.getParameter,p=e.WebGL2RenderingContext.prototype.getParameter,c=r.useBaseHandler({apply:(l,h,m)=>{const w=h.getExtension("WEBGL_debug_renderer_info");if(w){if(m[0]===w.UNMASKED_VENDOR_WEBGL){const v=n("normal.glVendor",t.fp.normal.glVendor);if(v)return v}else if(m[0]===w.UNMASKED_RENDERER_WEBGL){const v=n("normal.glRenderer",t.fp.normal.glRenderer);if(v)return v}}return l.apply(h,m)}});e.WebGLRenderingContext.prototype.getParameter=r.newProxy(o,c),e.WebGL2RenderingContext.prototype.getParameter=r.newProxy(p,c)}}},toDataURL:{condition:({conf:e})=>e.fp.other.canvas.type!==y.default||e.fp.other.webgl.type!==y.default,onEnable:({win:e,conf:t,hooks:r,rawObjects:n,getValue:i})=>{const u=e.HTMLCanvasElement.prototype.toDataURL;e.HTMLCanvasElement.prototype.toDataURL=r.newBaseProxy(u,{apply:(s,o,p)=>{if(t.fp.other.canvas.type!==y.default){const c=o.getContext("2d");if(c){const l=i("other.canvas",t.fp.other.canvas);return l&&n.getImageData&&ie(n.getImageData,l,c,0,0,o.width,o.height),s.apply(o,p)}}if(t.fp.other.webgl.type!==y.default){const c=o.getContext("webgl")??o.getContext("webgl2");if(c){const l=i("other.webgl",t.fp.other.webgl);return l&&ce(c,l),s.apply(o,p)}}return s.apply(o,p)}})}},audio:{condition:({conf:e})=>e.fp.other.audio.type!==y.default,onEnable:({win:e,conf:t,hooks:r,random:n})=>{const i=e.OfflineAudioContext.prototype.createDynamicsCompressor;e.OfflineAudioContext.prototype.createDynamicsCompressor=r.newBaseProxy(i,{apply:(u,s,o)=>{const p=n("other.audio",t.fp.other.audio);if(p===null)return u.apply(s,o);const c=u.apply(s,o),l=s.createGain();return l.gain.value=p*.001,c.connect(l),l.connect(s.destination),c}})}},timezone:{condition:({conf:e})=>e.fp.other.timezone.type!==y.default,onEnable:({win:e,conf:t,hooks:r,getValueDebounce:n})=>{const i=e.Intl.DateTimeFormat,u=e.Date,s=(o,p)=>{const c=new i("en-US",{timeZone:p??"Asia/Shanghai",weekday:"short",month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hour12:!1,timeZoneName:"longOffset"});try{return c.formatToParts(o).reduce((h,m)=>(h[m.type]=m.value,h),{})}catch{return null}};e.Intl.DateTimeFormat=r.newBaseProxy(i,{construct:(o,p,c)=>{const l=n("other.timezone",t.fp.other.timezone);return p[0]=p[0]??l.locale,p[1]=Object.assign({timeZone:l.zone},p[1]),new o(...p)},apply:(o,p,c)=>{const l=n("other.timezone",t.fp.other.timezone);return c[0]=c[0]??l.locale,c[1]=Object.assign({timeZone:l.zone},c[1]),o.apply(p,c)}}),e.Date=r.newBaseProxy(u,{apply:(o,p,c)=>new o(...c).toString()});{const o=p=>r.useBaseHandler({apply:(c,l,h)=>{const m=n("other.timezone",t.fp.other.timezone);if(m===null)return c.apply(l,h);const w=p(l,m);return w===null?c.apply(l,h):w}});e.Date.prototype.getTimezoneOffset=r.newProxy(e.Date.prototype.getTimezoneOffset,o((p,c)=>c.offset*-60)),e.Date.prototype.toString=r.newProxy(e.Date.prototype.toString,o((p,c)=>{const l=s(p,c.zone);return l===null?null:`${l.weekday} ${l.month} ${l.day} ${l.year} ${l.hour}:${l.minute}:${l.second} ${l.timeZoneName?.replace(":","")}`})),e.Date.prototype.toDateString=r.newProxy(e.Date.prototype.toDateString,o((p,c)=>{const l=s(p,c.zone);return l===null?null:`${l.weekday} ${l.month} ${l.day} ${l.year}`})),e.Date.prototype.toTimeString=r.newProxy(e.Date.prototype.toTimeString,o((p,c)=>{const l=s(p,c.zone);return l===null?null:`${l.hour}:${l.minute}:${l.second} ${l.timeZoneName?.replace(":","")}`}))}{const o=r.useBaseHandler({apply:(p,c,l)=>{const h=n("other.timezone",t.fp.other.timezone);return h&&(l[0]=l[0]??h.locale,l[1]=Object.assign({timeZone:h.zone},l[1])),p.apply(c,l)}});e.Date.prototype.toLocaleString=r.newProxy(e.Date.prototype.toLocaleString,o),e.Date.prototype.toLocaleDateString=r.newProxy(e.Date.prototype.toLocaleDateString,o),e.Date.prototype.toLocaleTimeString=r.newProxy(e.Date.prototype.toLocaleTimeString,o)}}},webrtc:{condition:({conf:e})=>e.fp.other.webrtc.type!==y.default,onEnable:({win:e})=>{Object.getOwnPropertyDescriptor(e.Navigator.prototype,"mediaDevices")?.get&&Object.defineProperty(e.navigator,"mediaDevices",{get(){return null}}),e.Navigator.prototype.getUserMedia&&(e.Navigator.prototype.getUserMedia=void 0),e.Navigator.prototype.mozGetUserMedia&&(e.Navigator.prototype.mozGetUserMedia=void 0),e.Navigator.prototype.webkitGetUserMedia&&(e.Navigator.prototype.webkitGetUserMedia=void 0),e.RTCDataChannel&&(e.RTCDataChannel=void 0),e.RTCIceCandidate&&(e.RTCIceCandidate=void 0),e.RTCConfiguration&&(e.RTCConfiguration=void 0),e.MediaStreamTrack&&(e.MediaStreamTrack=void 0),e.RTCPeerConnection&&(e.RTCPeerConnection=void 0),e.RTCSessionDescription&&(e.RTCSessionDescription=void 0),e.RTCDataChannel&&(e.RTCDataChannel=void 0),e.mozMediaStreamTrack&&(e.mozMediaStreamTrack=void 0),e.mozRTCPeerConnection&&(e.mozRTCPeerConnection=void 0),e.mozRTCSessionDescription&&(e.mozRTCSessionDescription=void 0),e.webkitMediaStreamTrack&&(e.webkitMediaStreamTrack=void 0),e.webkitRTCPeerConnection&&(e.webkitRTCPeerConnection=void 0),e.webkitRTCSessionDescription&&(e.webkitRTCSessionDescription=void 0)}},font:{condition:({conf:e})=>e.fp.other.font.type!==y.default,onEnable:({win:e,conf:t,hooks:r,getValueDebounce:n})=>{const i=Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,"offsetHeight")?.get;i&&Object.defineProperty(e.HTMLElement.prototype,"offsetHeight",{get:r.newBaseProxy(i,{apply(s,o,p){try{const c=i.call(o),l=o.style.fontFamily??"h"+c,h=n("other.font",t.fp.other.font,l);return c+h}catch{return i.call(o)}}})});const u=Object.getOwnPropertyDescriptor(e.HTMLElement.prototype,"offsetWidth")?.get;u&&Object.defineProperty(e.HTMLElement.prototype,"offsetWidth",{get:r.newBaseProxy(u,{apply(s,o,p){try{const c=u.call(o),l=o.style.fontFamily??"w"+c,h=n("other.font",t.fp.other.font,l);return c+h}catch{return u.call(o)}}})})}},webgpu:{condition:({conf:e})=>e.fp.other.webgpu.type!==y.default,onEnable:({win:e,conf:t,hooks:r,randomDebounce:n})=>{if(e.GPUAdapter)try{const i=(s,o)=>{const p=n("other.webgpu",t.fp.other.webgpu,o,1,64);return s&&s-Math.floor(p)},u=Object.getOwnPropertyDescriptor(e.GPUAdapter.prototype,"limits")?.get;u&&Object.defineProperty(e.GPUAdapter.prototype,"limits",{get:r.newBaseProxy(u,{apply(s,o,p){const c=s.apply(o,p);return r.newBaseProxy(c,{get(l,h){const m=l[h];switch(h){case"maxBufferSize":return i(m,0);case"maxStorageBufferBindingSize":return i(m,1)}return typeof m=="function"?m.bind(l):m}})}})})}catch{}if(e.GPUDevice)try{const i=(s,o)=>{const p=n("other.webgpu",t.fp.other.webgpu,o,1,64);return s&&s-Math.floor(p)},u=Object.getOwnPropertyDescriptor(e.GPUDevice.prototype,"limits")?.get;u&&Object.defineProperty(e.GPUDevice.prototype,"limits",{get:r.newBaseProxy(u,{apply(s,o,p){const c=s.apply(o,p);return r.newBaseProxy(c,{get(l,h){const m=l[h];switch(h){case"maxBufferSize":return i(m,0);case"maxStorageBufferBindingSize":return i(m,1)}return typeof m=="function"?m.bind(l):m}})}})})}catch{}if(e.GPUCommandEncoder?.prototype?.beginRenderPass)try{e.GPUCommandEncoder.prototype.beginRenderPass=r.newBaseProxy(e.GPUCommandEncoder.prototype.beginRenderPass,{apply(i,u,s){if(s?.[0]?.colorAttachments?.[0]?.clearValue)try{const o=s[0].colorAttachments[0].clearValue;let p=0;for(let c in o){let l=o[c];const h=n("other.webgpu",t.fp.other.webgpu,p++,.01,.001);l+=l*h*-1,o[c]=Math.abs(l)}s[0].colorAttachments[0].clearValue=o}catch{}return i.apply(u,s)}})}catch{}if(e.GPUQueue?.prototype?.writeBuffer)try{e.GPUQueue.prototype.writeBuffer=r.newBaseProxy(e.GPUQueue.prototype.writeBuffer,{apply(i,u,s){const o=s?.[2];if(o&&o instanceof Float32Array)try{const p=Math.ceil(o.length*.05);let c=0;const l=Array(o.length).map((h,m)=>m).sort(()=>n("other.webgpu",t.fp.other.webgpu,c++,1,-1)).slice(0,p);c=0;for(let h=0;h<l.length;h++){const m=l[h];let w=o[m];const v=n("other.webgpu",t.fp.other.webgpu,c++,1e-4,-1e-4);o[m]+=v*w}}catch{}return i.apply(u,s)}})}catch{}}},".ownProperties":{onEnable:({win:e,symbol:t,hooks:r})=>{{const n=i=>r.useBaseHandler({apply(u,s,o){const p=o[0];if(p!=null&&typeof p=="object"){const c=p[t.own];if(c)return c[i]}return u.apply(s,o)}});e.Object.getOwnPropertyNames=r.newProxy(e.Object.getOwnPropertyNames,n("names")),e.Object.getOwnPropertySymbols=r.newProxy(e.Object.getOwnPropertySymbols,n("symbols")),e.Object.getOwnPropertyDescriptors=r.newProxy(e.Object.getOwnPropertyDescriptors,n("descriptors")),e.Reflect.ownKeys=r.newProxy(e.Reflect.ownKeys,n("keys"))}{const n=r.useBaseHandler({apply(i,u,s){const o=s[0];if(o!=null&&typeof o=="object"){const p=o[t.own];if(p)return p.descriptors?.[s[1]]}return i.apply(u,s)}});e.Object.getOwnPropertyDescriptor=r.newProxy(e.Object.getOwnPropertyDescriptor,n),e.Reflect.getOwnPropertyDescriptor=r.newProxy(e.Reflect.getOwnPropertyDescriptor,n)}}},".prototypeOf":{onEnable:({win:e,symbol:t,registry:r,hooks:n})=>{const i=n.useBaseHandler({apply(u,s,o){const p=o[0],c=o[1];if(c!=null&&r.has(p)){const l=c[t.raw];l&&(o[1]=l)}return Reflect.apply(u,s,o)}});e.Object.setPrototypeOf=n.newProxy(e.Object.setPrototypeOf,i),e.Reflect.setPrototypeOf=n.newProxy(e.Reflect.setPrototypeOf,i)}},".toString":{onEnable:({win:e,symbol:t,registry:r,hooks:n})=>{e.Function.prototype.toString=n.newBaseProxy(e.Function.prototype.toString,{apply(i,u,s){if(u!=null&&r.has(u)){const o=u[t.raw];if(o)return Reflect.apply(i,o,s)}return Reflect.apply(i,u,s)}})}},".create":{onEnable:({win:e,symbol:t,registry:r,hooks:n})=>{e.Object.create=n.newBaseProxy(e.Object.create,{apply(i,u,s){const o=s[0];if(o!=null&&r.has(o)){const p=o[t.raw];p&&(s[0]=p)}return Reflect.apply(i,u,s)}})}}}).map(([e,t])=>({...t,name:e})),z="my_fingerprint",N={languages:navigator.languages,width:screen.width,height:screen.height},Z={hardwareConcurrencys:[8,12,16],colorDepths:[16,24,32],pixelDepths:[16,24,32]},Te={"navigator.language":e=>P(N.languages,e),"navigator.languages":e=>D(N.languages,e),"navigator.hardwareConcurrency":e=>P(Z.hardwareConcurrencys,e),"screen.height":e=>{const t=e%100-50,r=N.width+t;return Math.round(r*N.height/N.width)},"screen.width":e=>{const t=e%100-50;return N.width+t},"screen.colorDepth":e=>P(Z.colorDepths,e),"screen.pixelDepth":e=>P(Z.pixelDepths,e),"other.canvas":De,"other.audio":void 0,"other.webgl":Ce,"other.font":Ee,"other.webgpu":void 0},Ae={"other.timezone":void 0,"normal.glVendor":void 0,"normal.glRenderer":void 0},K=new Map,Be=Oe(()=>{b(window.top??window,{type:d.SetHookRecords,data:Object.fromEntries(K)},"*")}),T=function(e){const t=e.split(".");e=t[t.length-1];const r=K.get(e)??0;K.set(e,r+1),Be()},ue=Me(T,200);class Y{win;info;seed;conf;rawObjects={};registry=new WeakSet;symbol={own:Symbol("OwnProperty"),raw:Symbol("RawValue")};hooks={useBaseHandler:t=>({...t,get:(r,n,i)=>n===this.symbol.raw?r:n==="caller"||n==="arguments"?r[n]:(t.get??Reflect.get)(r,n,i)}),newProxy:(t,r)=>{const n=new Proxy(t,r);return this.registry.add(n),n},newBaseProxy:(t,r)=>this.hooks.newProxy(t,this.hooks.useBaseHandler(r))};constructor(t,r,n){if(!t)throw new Error("win is required");if(t===window.top){if(r.hooked)throw new Error("win is already hooked");r.hooked=!0}else{let i=!1;try{i=t[z]}catch{throw new Error("unable to access cross source")}if(i)throw new Error("win is already hooked");t[z]=!0}this.win=t,this.info=r,this.conf=n,this.seed={page:r.seed,domain:Math.floor(x(r.host,Number.MAX_SAFE_INTEGER,1)),browser:n.seed.browser??O(),global:n.seed.global??O()},this.hookContent()}isEnable(){return!!this.conf.enable}hookContent(){if(this.isEnable())for(const t of Ne)(!t.condition||t.condition(this)===!0)&&t.onEnable?.(this)}hookIframe=t=>{try{new Y(t.contentWindow,this.info,this.conf)}catch{}};isAllDefault(t){if(!t)return!0;for(const r of Object.values(t))if(r.type!==y.default)return!1;return!0}getSeed=t=>{switch(t){case y.page:return this.seed.page;case y.domain:return this.seed.domain;case y.browser:return this.seed.browser;case y.global:return this.seed.global;case y.default:default:return null}};_getValue=(t,r,n)=>{switch(r.type){case y.default:return null;case y.value:{const i=Ae[t];return i?i(r.value,n):r.value}case y.browser:case y.domain:case y.global:case y.page:{const i=Te[t];if(i){const u=this.getSeed(r.type);if(u!==null)return i(u,n)}return null}default:return null}};getValue=(t,r,n)=>r?(T(t),this._getValue(t,r,n)):null;getValueDebounce=(t,r,n)=>r?(ue(t),this._getValue(t,r,n)):null;random=(t,r,n=0,i=1,u=0)=>{T(t);const s=this.getSeed(r?.type);return s===null?null:x(s+n*10,i,u)};randomDebounce=(t,r,n=0,i=1,u=0)=>{ue(t);const s=this.getSeed(r?.type);return s===null?null:x(s+n*10,i,u)}}const pe=a;(()=>{if(!window)return;const e=(t,r)=>{if(r&&!Re(pe.whitelist,r.host))try{new Y(t,r,pe.config)}catch{}};if(window.top===window){const t={url:location.href,host:location.hostname,seed:O(),hooked:!1,browser:_e(navigator.userAgent)};window[z]=t,window.addEventListener("message",r=>{const n=g(r);!n||!r.source||n.type===d.GetHookInfo&&b(r.source,{type:d.StartHook,data:t},r.origin)}),e(window,t);return}try{const r=(window.top??window)[z];e(window,r)}catch{window.addEventListener("message",r=>{const n=g(r);n?.type===d.StartHook&&e(window,n.data)}),b(window.top??window,{type:d.GetHookInfo},"*")}})()}const ge="core";let X;const oe=()=>!!chrome.userScripts,tt=async(a,d)=>{oe()||!d.config.enable||await chrome.scripting.executeScript({target:{tabId:a,allFrames:!0},world:"MAIN",injectImmediately:!0,args:[d],func:Se}).catch(()=>{})},rt=a=>(X||(X=Se.toString()),`(function(fun){fun(${JSON.stringify(a)});})(${X});`),G=async()=>{if(!oe())return;const[a]=await C();if(a.config.enable){const d=[{id:ge,allFrames:!0,runAt:"document_start",world:"MAIN",matches:["*://*/*"],js:[{code:rt(a)}]}];try{await chrome.userScripts.update(d)}catch{await chrome.userScripts.register(d)}}else chrome.userScripts.unregister({ids:[ge]})},te=new Map;let W;const nt=async()=>W||(W=(await fetch("https://api.github.com/repos/omegaee/my-fingerprint/releases/latest").then(d=>d.json())).tag_name,W);chrome.runtime.onInstalled.addListener(({reason:a})=>{(a===chrome.runtime.OnInstalledReason.INSTALL||a===chrome.runtime.OnInstalledReason.UPDATE)&&(ne().then(()=>G()),xe())});chrome.runtime.onStartup.addListener(()=>{ne().then(()=>G()),xe()});chrome.runtime.onMessage.addListener((a,d,f)=>{switch(a.type){case B.SetConfig:return ee(a.config).then(g=>{G(),a.result&&f(g)}),a.result;case B.GetNotice:{f(te.get(a.tabId));break}case B.SetHookRecords:{const g=d.tab?.id;if(g===void 0)return;te.set(g,a.data);const[b,y]=Qe(a.data);chrome.action.setBadgeText({tabId:g,text:b}),chrome.action.setBadgeBackgroundColor({tabId:g,color:y});break}case B.UpdateWhitelist:{const g=()=>G();a.clean&&Ye().then(g),a.data&&ve(a.data).then(g);break}case B.GetNewVersion:return nt().then(g=>{f(g)}),!0;case B.Subscribe:return(async()=>{if(a.url!=null&&await ee({subscribe:{url:a.url.trim()}}),await me()){const[b]=await C();f(b)}else f(void 0)})(),!0}});chrome.tabs.onUpdated.addListener(async(a,d,f)=>{if(d.status==="loading"){const[g,{match:b}]=await C();oe()||tt(a,g);const y=f.url?Fe(f.url):void 0;if(!y?.hostname)return;b(y.hostname)?(E(a),Je(a)):E(void 0,a)}});chrome.tabs.onRemoved.addListener(a=>{E(void 0,a),te.delete(a),et(a)});chrome.permissions.onAdded.addListener(a=>{a.permissions?.includes("userScripts")&&G()});
